# 19.1 Zustand 基础


## 1. Zustand 原理

Zustand 是一个极简的状态管理库，核心原理是 **发布订阅模式** + **React Hooks (useSyncExternalStore)**。

它不需要 Context Provider 包裹，状态存储在 React 组件树外部。

### 1.1 模拟实现 (简易版)

```typescript
import { useSyncExternalStore } from 'react';

function create(createState) {
  let state;
  const listeners = new Set();

  const setState = (partial, replace) => {
    const nextState = typeof partial === 'function' ? partial(state) : partial;
    if (!Object.is(nextState, state)) {
      state = replace ? nextState : { ...state, ...nextState };
      listeners.forEach(listener => listener());
    }
  };

  const getState = () => state;

  const subscribe = (listener) => {
    listeners.add(listener);
    return () => listeners.delete(listener);
  };

  const api = { setState, getState, subscribe };
  state = createState(setState, getState, api);

  const useStore = (selector = (s) => s) => {
    return useSyncExternalStore(subscribe, () => selector(state));
  };

  return useStore;
}
```

## 2. 基本使用

```tsx
import { create } from 'zustand';

const useStore = create((set) => ({
  count: 0,
  inc: () => set((state) => ({ count: state.count + 1 })),
}));

function Counter() {
  const { count, inc } = useStore();
  return <button onClick={inc}>{count}</button>;
}
```
