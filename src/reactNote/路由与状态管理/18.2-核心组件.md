# 18.2 核心组件


## 1. Router 组件

`Router` 是路由的容器，负责监听 URL 变化并向下分发当前的 `location` 和 `navigator`。

### 模拟实现

```tsx
import React, { useState, useEffect, createContext, useContext } from 'react';
import { createBrowserHistory } from 'history';

const NavigationContext = createContext(null);
const LocationContext = createContext(null);

export function BrowserRouter({ children }) {
  const history = React.useMemo(() => createBrowserHistory(), []);
  const [location, setLocation] = useState(history.location);

  useEffect(() => {
    const unlisten = history.listen(({ location }) => {
      setLocation(location);
    });
    return unlisten;
  }, [history]);

  return (
    <NavigationContext.Provider value={history}>
      <LocationContext.Provider value={location}>
        {children}
      </LocationContext.Provider>
    </NavigationContext.Provider>
  );
}
```

## 2. Route 组件

`Route` 负责根据当前 URL 匹配 `path`，匹配成功则渲染对应的 `element`。

### 模拟实现

```tsx
export function Route({ path, element }) {
  const location = useContext(LocationContext);
  // 简单匹配
  const match = location.pathname === path;
  
  return match ? element : null;
}
```

## 3. Link 组件

`Link` 替代 `<a>` 标签，拦截点击事件，使用 `history.push` 跳转。

### 模拟实现

```tsx
export function Link({ to, children }) {
  const history = useContext(NavigationContext);

  const handleClick = (e) => {
    e.preventDefault(); // 阻止默认的页面刷新
    history.push(to);
  };

  return (
    <a href={to} onClick={handleClick}>
      {children}
    </a>
  );
}
```

## 4. Navigate 组件

声明式重定向。

### 模拟实现

```tsx
export function Navigate({ to }) {
  const history = useContext(NavigationContext);
  
  useEffect(() => {
    history.push(to);
  }, [history, to]);
  
  return null;
}
```
