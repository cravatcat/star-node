# 16.2 useSpring (Simple)

## 1. 实现思路

简易弹簧动画 Hook。

## 2. 代码实现

```typescript
import { useState, useEffect } from 'react';

// 简化版弹簧物理公式
function useSpring(targetValue: number, tension: number = 50, friction: number = 3) {
  const [value, setValue] = useState(targetValue);
  const [velocity, setVelocity] = useState(0);

  useEffect(() => {
    let animationFrameId: number;
    let lastTime = performance.now();
    let currentVal = value;
    let currentVel = velocity;

    const animate = (time: number) => {
      const deltaTime = (time - lastTime) / 1000; // seconds
      lastTime = time;

      const displacement = targetValue - currentVal;
      const acceleration = tension * displacement - friction * currentVel;
      
      currentVel += acceleration * deltaTime;
      currentVal += currentVel * deltaTime;

      setValue(currentVal);
      setVelocity(currentVel);

      if (Math.abs(displacement) > 0.01 || Math.abs(currentVel) > 0.01) {
        animationFrameId = requestAnimationFrame(animate);
      } else {
        setValue(targetValue);
      }
    };

    animationFrameId = requestAnimationFrame(animate);
    return () => cancelAnimationFrame(animationFrameId);
  }, [targetValue, tension, friction]);

  return value;
}

export default useSpring;
```

## 3. 使用示例

```tsx
const animatedValue = useSpring(targetValue);
```

## 4. 常见问题

- **推荐**：生产环境建议使用 `react-spring` 或 `framer-motion`。
