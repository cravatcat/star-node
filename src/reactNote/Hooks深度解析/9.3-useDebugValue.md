# 9.3 useDebugValue

`useDebugValue` 是一个专门用于**开发调试**的 Hook。它允许你在 React DevTools 中为自定义 Hook 添加额外的标签或格式化显示的值。

## 1. 核心作用

当你编写一个自定义 Hook（例如 `useFriendStatus`）时，默认情况下，React DevTools 只会显示该 Hook 的名称和它内部使用的基础 Hooks（State, Effect 等）。
`useDebugValue` 可以让你在 DevTools 中显示一个自定义的值（如 "Online", "Offline"），方便一眼看出当前 Hook 的状态。

## 2. 语法

```javascript
useDebugValue(value, format?);
```

*   **value**: 你想在 DevTools 中显示的值（可以是字符串、数字、对象等）。
*   **format** (可选): 一个格式化函数。如果 `value` 计算代价昂贵，可以传入这个函数，React 只有在 DevTools 打开且检查该 Hook 时才会调用它。

## 3. 使用示例

### 3.1 基础用法

假设我们有一个检测在线状态的 Hook。

```javascript
import { useState, useEffect, useDebugValue } from 'react';

function useOnlineStatus() {
  const [isOnline, setIsOnline] = useState(navigator.onLine);

  useEffect(() => {
    const handleStatusChange = () => setIsOnline(navigator.onLine);
    window.addEventListener('online', handleStatusChange);
    window.addEventListener('offline', handleStatusChange);
    return () => {
      window.removeEventListener('online', handleStatusChange);
      window.removeEventListener('offline', handleStatusChange);
    };
  }, []);

  // 在 DevTools 中显示 "Online" 或 "Offline"
  useDebugValue(isOnline ? 'Online' : 'Offline');

  return isOnline;
}
```

**在 DevTools 中的效果：**
如果不加 `useDebugValue`，你会看到：
```
Hooks
  - State: true
```
加上后，你会看到：
```
Hooks
  - State: true
  - useOnlineStatus: "Online"
```

### 3.2 延迟格式化

如果调试值的生成比较耗时（例如需要解析复杂的日期格式），可以使用第二个参数。

```javascript
function useDate() {
  const [date, setDate] = useState(new Date());
  
  // 只有在开发者打开 DevTools 检查此组件时，才会执行 formatData
  useDebugValue(date, date => date.toISOString());
  
  return date;
}
```

## 4. 最佳实践

*   **不要在所有 Hook 中使用**：`useDebugValue` 主要是为了调试复杂的、共享的自定义 Hook 库。对于应用内部简单的自定义 Hook，通常不需要它，因为直接看内部的 State 已经足够清晰了。
*   **性能影响**：虽然开销很小，但它毕竟是额外的逻辑。在生产环境中，如果使用了构建工具（如 Terser），未使用的 `useDebugValue` 可能会被优化掉，或者它的执行开销可以忽略不计。但在高频调用的 Hook 中还是要谨慎。

## 5. 总结

`useDebugValue` 是一个“锦上添花”的工具，它不影响代码逻辑，只服务于开发者体验。如果你正在维护一个开源的 Hook 库，使用它能让你的库对使用者更加友好。
