# 13.6 useIntersectionObserver

## 1. 实现思路

封装 IntersectionObserver API，检测元素可见性。

## 2. 代码实现

```typescript
import { useEffect, useRef, useState } from 'react';

function useIntersectionObserver(
  options: IntersectionObserverInit = {}
) {
  const [entry, setEntry] = useState<IntersectionObserverEntry>();
  const ref = useRef<Element>(null);

  useEffect(() => {
    const node = ref.current;
    if (!node) return;

    const observer = new IntersectionObserver(([entry]) => {
      setEntry(entry);
    }, options);

    observer.observe(node);

    return () => observer.disconnect();
  }, [options.root, options.rootMargin, options.threshold]);

  return [ref, entry] as const;
}

export default useIntersectionObserver;
```

## 3. 使用示例

```tsx
const [ref, entry] = useIntersectionObserver({ threshold: 0.5 });
const isVisible = !!entry?.isIntersecting;
```

## 4. 常见问题

- **Frozen Object**：注意 options 对象的引用稳定性，直接传入字面量可能导致无限循环。
