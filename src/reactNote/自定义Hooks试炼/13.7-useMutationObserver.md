# 13.7 useMutationObserver

## 1. 实现思路

封装 MutationObserver API，监听 DOM 树变化。

## 2. 代码实现

```typescript
import { useEffect, useRef, useState } from 'react';

function useMutationObserver(
  callback: MutationCallback,
  options: MutationObserverInit
) {
  const ref = useRef<Element>(null);

  useEffect(() => {
    const node = ref.current;
    if (!node) return;

    const observer = new MutationObserver(callback);
    observer.observe(node, options);

    return () => observer.disconnect();
  }, [callback, options]);

  return ref;
}

export default useMutationObserver;
```

## 3. 使用示例

```tsx
const ref = useMutationObserver(
  (mutations) => console.log(mutations),
  { attributes: true, childList: true }
);
```

## 4. 常见问题

- **性能消耗**：MutationObserver 可能非常频繁地触发，注意回调函数的性能。
