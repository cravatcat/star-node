# 11.6 useMap / useSet

## 1. 实现思路

封装 Map 和 Set 的操作，使其具备响应式能力。

## 2. 代码实现

```typescript
import { useState, useMemo } from 'react';

export function useMap<K, V>(initialValue?: Iterable<readonly [K, V]>) {
  const [map, setMap] = useState(new Map(initialValue));

  const actions = useMemo(() => ({
    set: (key: K, value: V) => {
      setMap(prev => {
        const next = new Map(prev);
        next.set(key, value);
        return next;
      });
    },
    remove: (key: K) => {
      setMap(prev => {
        const next = new Map(prev);
        next.delete(key);
        return next;
      });
    },
    clear: () => setMap(new Map()),
  }), []);

  return [map, actions] as const;
}

export function useSet<K>(initialValue?: Iterable<K>) {
  const [set, setSet] = useState(new Set(initialValue));

  const actions = useMemo(() => ({
    add: (key: K) => {
      setSet(prev => {
        const next = new Set(prev);
        next.add(key);
        return next;
      });
    },
    remove: (key: K) => {
      setSet(prev => {
        const next = new Set(prev);
        next.delete(key);
        return next;
      });
    },
    clear: () => setSet(new Set()),
  }), []);

  return [set, actions] as const;
}
```

## 3. 使用示例

```tsx
const [map, { set, remove }] = useMap([['a', 1]]);
const [set, { add }] = useSet([1, 2, 3]);
```

## 4. 常见问题

- **引用变化**：每次操作都会生成新的 Map/Set 对象，确保 React 感知到变化。
