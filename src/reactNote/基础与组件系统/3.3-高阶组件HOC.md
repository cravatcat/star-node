# 3.3 é«˜é˜¶ç»„ä»¶ (HOC) ğŸŒŸ

## æ¦‚å¿µè®²è§£

**é«˜é˜¶ç»„ä»¶ï¼ˆHigher-Order Componentï¼ŒHOCï¼‰** æ˜¯ React ä¸­ç”¨äºå¤ç”¨ç»„ä»¶é€»è¾‘çš„ä¸€ç§é«˜çº§æŠ€å·§ã€‚HOC æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å¢å¼ºç»„ä»¶ã€‚

```javascript
const EnhancedComponent = higherOrderComponent(WrappedComponent);
```

HOC ä¸æ˜¯ React API çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ä¸€ç§åŸºäº React ç»„åˆç‰¹æ€§çš„è®¾è®¡æ¨¡å¼ã€‚

---

## HOC è®¾è®¡æ¨¡å¼

### å®ç°æ€è·¯

1. HOC æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œæ¥æ”¶ç»„ä»¶è¿”å›æ–°ç»„ä»¶
2. ä¸ä¿®æ”¹åŸç»„ä»¶ï¼Œè€Œæ˜¯é€šè¿‡ç»„åˆçš„æ–¹å¼å¢å¼ºåŠŸèƒ½
3. é€ä¼ æ‰€æœ‰ props ç»™è¢«åŒ…è£…ç»„ä»¶
4. æœ€å¤§åŒ–å¯ç»„åˆæ€§

### åŸºç¡€ç¤ºä¾‹

```jsx
// æœ€ç®€å•çš„ HOC
function withLogger(WrappedComponent) {
  return function EnhancedComponent(props) {
    console.log('ç»„ä»¶æ¸²æŸ“:', WrappedComponent.name);
    return <WrappedComponent {...props} />;
  };
}

// ä½¿ç”¨
function MyComponent({ name }) {
  return <div>Hello {name}</div>;
}

const EnhancedMyComponent = withLogger(MyComponent);
```

### å¸¸è§ HOC å®ç°

#### 1. withAuth - æƒé™æ§åˆ¶

```jsx
function withAuth(WrappedComponent) {
  return function AuthComponent(props) {
    const [isAuthenticated, setIsAuthenticated] = useState(false);
    const [isLoading, setIsLoading] = useState(true);

    useEffect(() => {
      // æ¨¡æ‹Ÿæ£€æŸ¥ç”¨æˆ·è®¤è¯çŠ¶æ€
      const checkAuth = async () => {
        try {
          const token = localStorage.getItem('token');
          const response = await fetch('/api/verify', {
            headers: { Authorization: `Bearer ${token}` }
          });
          setIsAuthenticated(response.ok);
        } catch (error) {
          setIsAuthenticated(false);
        } finally {
          setIsLoading(false);
        }
      };

      checkAuth();
    }, []);

    if (isLoading) {
      return <div>Loading...</div>;
    }

    if (!isAuthenticated) {
      return <div>è¯·å…ˆç™»å½•</div>;
    }

    return <WrappedComponent {...props} />;
  };
}

// ä½¿ç”¨
function Dashboard({ user }) {
  return <div>æ¬¢è¿ {user.name}</div>;
}

const ProtectedDashboard = withAuth(Dashboard);
```

#### 2. withLoading - åŠ è½½çŠ¶æ€

```jsx
function withLoading(WrappedComponent) {
  return function LoadingComponent({ isLoading, ...props }) {
    if (isLoading) {
      return (
        <div className="loading-spinner">
          <span>åŠ è½½ä¸­...</span>
        </div>
      );
    }

    return <WrappedComponent {...props} />;
  };
}

// ä½¿ç”¨
function UserList({ users }) {
  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
}

const UserListWithLoading = withLoading(UserList);

// åœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨
function App() {
  const [users, setUsers] = useState([]);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    fetchUsers().then(data => {
      setUsers(data);
      setIsLoading(false);
    });
  }, []);

  return <UserListWithLoading isLoading={isLoading} users={users} />;
}
```

#### 3. withLogger - æ—¥å¿—è®°å½•

```jsx
function withLogger(WrappedComponent) {
  return class extends React.Component {
    componentDidMount() {
      console.log(`[${WrappedComponent.name}] ç»„ä»¶å·²æŒ‚è½½`);
    }

    componentDidUpdate(prevProps) {
      console.log(`[${WrappedComponent.name}] ç»„ä»¶å·²æ›´æ–°`);
      console.log('æ—§ props:', prevProps);
      console.log('æ–° props:', this.props);
    }

    componentWillUnmount() {
      console.log(`[${WrappedComponent.name}] ç»„ä»¶å°†å¸è½½`);
    }

    render() {
      return <WrappedComponent {...this.props} />;
    }
  };
}

// ä½¿ç”¨
const LoggedComponent = withLogger(MyComponent);
```

#### 4. withData - æ•°æ®è·å–

```jsx
function withData(WrappedComponent, dataSource) {
  return function DataComponent(props) {
    const [data, setData] = useState(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);

    useEffect(() => {
      const fetchData = async () => {
        try {
          setLoading(true);
          const result = await dataSource(props);
          setData(result);
        } catch (err) {
          setError(err);
        } finally {
          setLoading(false);
        }
      };

      fetchData();
    }, [props.id]); // ä¾èµ–äº props.id

    if (loading) return <div>åŠ è½½ä¸­...</div>;
    if (error) return <div>é”™è¯¯: {error.message}</div>;

    return <WrappedComponent {...props} data={data} />;
  };
}

// ä½¿ç”¨
const fetchUser = async ({ id }) => {
  const response = await fetch(`/api/users/${id}`);
  return response.json();
};

function UserProfile({ data }) {
  return (
    <div>
      <h2>{data.name}</h2>
      <p>{data.email}</p>
    </div>
  );
}

const UserProfileWithData = withData(UserProfile, fetchUser);

// ä½¿ç”¨æ—¶
<UserProfileWithData id={123} />
```

### æ¨¡æ‹Ÿå®ç°ï¼šHOC æ ¸å¿ƒæœºåˆ¶

```javascript
// HOC å·¥å‚å‡½æ•°
function createHOC(enhancementLogic) {
  return function higherOrderComponent(WrappedComponent) {
    // è¿”å›å¢å¼ºåçš„ç»„ä»¶
    return function EnhancedComponent(props) {
      // æ‰§è¡Œå¢å¼ºé€»è¾‘
      const enhancedProps = enhancementLogic(props);
      
      // æ¸²æŸ“åŸç»„ä»¶ï¼Œä¼ å…¥å¢å¼ºçš„ props
      return <WrappedComponent {...props} {...enhancedProps} />;
    };
  };
}

// ä½¿ç”¨å·¥å‚åˆ›å»ºå…·ä½“çš„ HOC
const withTimestamp = createHOC((props) => ({
  timestamp: Date.now()
}));

const withUserId = createHOC((props) => ({
  userId: localStorage.getItem('userId')
}));

// åº”ç”¨ HOC
const EnhancedComponent = withTimestamp(withUserId(MyComponent));
```

---

## HOC ç»„åˆ

### compose å‡½æ•°å®ç°

```javascript
// ä»å³åˆ°å·¦ç»„åˆå¤šä¸ª HOC
function compose(...funcs) {
  if (funcs.length === 0) {
    return arg => arg;
  }

  if (funcs.length === 1) {
    return funcs[0];
  }

  return funcs.reduce((a, b) => (...args) => a(b(...args)));
}

// ä½¿ç”¨ç¤ºä¾‹
const enhance = compose(
  withAuth,
  withLoading,
  withLogger,
  withData(fetchUser)
);

const EnhancedComponent = enhance(MyComponent);

// ç­‰ä»·äº
const EnhancedComponent = withAuth(
  withLoading(
    withLogger(
      withData(MyComponent, fetchUser)
    )
  )
);
```

### å¤šä¸ª HOC é“¾å¼è°ƒç”¨

```jsx
// å®šä¹‰å¤šä¸ª HOC
function withTheme(WrappedComponent) {
  return function ThemedComponent(props) {
    const theme = useContext(ThemeContext);
    return <WrappedComponent {...props} theme={theme} />;
  };
}

function withUser(WrappedComponent) {
  return function UserComponent(props) {
    const user = useContext(UserContext);
    return <WrappedComponent {...props} user={user} />;
  };
}

function withAnalytics(WrappedComponent) {
  return function AnalyticsComponent(props) {
    useEffect(() => {
      analytics.track('Component Viewed', {
        component: WrappedComponent.name
      });
    }, []);

    return <WrappedComponent {...props} />;
  };
}

// ç»„åˆä½¿ç”¨
const MyComponent = ({ theme, user, data }) => {
  return (
    <div style={{ background: theme.background }}>
      <h1>Hello {user.name}</h1>
      <p>{data}</p>
    </div>
  );
};

// æ–¹å¼1ï¼šé€å±‚åŒ…è£…
const Enhanced1 = withTheme(withUser(withAnalytics(MyComponent)));

// æ–¹å¼2ï¼šä½¿ç”¨ compose
const Enhanced2 = compose(
  withTheme,
  withUser,
  withAnalytics
)(MyComponent);

// æ–¹å¼3ï¼šä½¿ç”¨è£…é¥°å™¨è¯­æ³•ï¼ˆéœ€è¦ Babel æ”¯æŒï¼‰
@withTheme
@withUser
@withAnalytics
class MyComponent extends React.Component {
  render() {
    return <div>...</div>;
  }
}
```

---

## å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 1. ref è½¬å‘é—®é¢˜

HOC ä¼šå¯¼è‡´ ref æ— æ³•ä¼ é€’åˆ°è¢«åŒ…è£…ç»„ä»¶ï¼Œéœ€è¦ä½¿ç”¨ `forwardRef`ã€‚

```jsx
// âŒ é—®é¢˜ï¼šref æ— æ³•ä¼ é€’
function withLogger(WrappedComponent) {
  return function LoggerComponent(props) {
    console.log('Rendering');
    return <WrappedComponent {...props} />;
  };
}

// âœ… è§£å†³ï¼šä½¿ç”¨ forwardRef
function withLogger(WrappedComponent) {
  function LoggerComponent(props, ref) {
    console.log('Rendering');
    return <WrappedComponent {...props} ref={ref} />;
  }
  
  return React.forwardRef(LoggerComponent);
}

// ä½¿ç”¨
const EnhancedInput = withLogger(Input);

function Parent() {
  const inputRef = useRef(null);
  
  useEffect(() => {
    inputRef.current.focus(); // ç°åœ¨å¯ä»¥è®¿é—®åˆ° Input çš„ ref
  }, []);
  
  return <EnhancedInput ref={inputRef} />;
}
```

### 2. é™æ€æ–¹æ³•ä¸¢å¤±

HOC è¿”å›çš„æ–°ç»„ä»¶ä¸ä¼šè‡ªåŠ¨å¤åˆ¶åŸç»„ä»¶çš„é™æ€æ–¹æ³•ã€‚

```jsx
// åŸç»„ä»¶æœ‰é™æ€æ–¹æ³•
class MyComponent extends React.Component {
  static staticMethod() {
    return 'static method';
  }
  
  render() {
    return <div>Component</div>;
  }
}

// âŒ é—®é¢˜ï¼šé™æ€æ–¹æ³•ä¸¢å¤±
function withHOC(WrappedComponent) {
  return function Enhanced(props) {
    return <WrappedComponent {...props} />;
  };
}

const Enhanced = withHOC(MyComponent);
Enhanced.staticMethod(); // undefined

// âœ… è§£å†³æ–¹æ¡ˆ1ï¼šæ‰‹åŠ¨å¤åˆ¶
function withHOC(WrappedComponent) {
  function Enhanced(props) {
    return <WrappedComponent {...props} />;
  }
  
  // æ‰‹åŠ¨å¤åˆ¶é™æ€æ–¹æ³•
  Enhanced.staticMethod = WrappedComponent.staticMethod;
  
  return Enhanced;
}

// âœ… è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨ hoist-non-react-statics åº“
import hoistNonReactStatics from 'hoist-non-react-statics';

function withHOC(WrappedComponent) {
  function Enhanced(props) {
    return <WrappedComponent {...props} />;
  }
  
  // è‡ªåŠ¨å¤åˆ¶æ‰€æœ‰é React é™æ€æ–¹æ³•
  hoistNonReactStatics(Enhanced, WrappedComponent);
  
  return Enhanced;
}

// âœ… è§£å†³æ–¹æ¡ˆ3ï¼šå¯¼å‡ºé™æ€æ–¹æ³•
MyComponent.staticMethod = function() {
  return 'static method';
};

export default withHOC(MyComponent);
export { staticMethod } from './MyComponent';
```

### 3. props å†²çª

HOC å¯èƒ½ä¼šè¦†ç›–åŸç»„ä»¶çš„ propsã€‚

```jsx
// âŒ é—®é¢˜ï¼šprops å†²çª
function withUser(WrappedComponent) {
  return function Enhanced(props) {
    const user = { name: 'HOC User' };
    // å¦‚æœ props ä¸­ä¹Ÿæœ‰ userï¼Œä¼šè¢«è¦†ç›–
    return <WrappedComponent {...props} user={user} />;
  };
}

// âœ… è§£å†³æ–¹æ¡ˆ1ï¼šä½¿ç”¨å‘½åç©ºé—´
function withUser(WrappedComponent) {
  return function Enhanced(props) {
    const user = { name: 'HOC User' };
    return <WrappedComponent {...props} injectedUser={user} />;
  };
}

// âœ… è§£å†³æ–¹æ¡ˆ2ï¼šåˆå¹¶ props
function withUser(WrappedComponent) {
  return function Enhanced(props) {
    const hocUser = { name: 'HOC User' };
    const mergedUser = { ...hocUser, ...props.user };
    return <WrappedComponent {...props} user={mergedUser} />;
  };
}

// âœ… è§£å†³æ–¹æ¡ˆ3ï¼šä½¿ç”¨å¯¹è±¡åŒ…è£…
function withUser(WrappedComponent) {
  return function Enhanced(props) {
    const user = { name: 'HOC User' };
    return <WrappedComponent {...props} hoc={{ user }} />;
  };
}
```

### 4. åœ¨ render ä¸­åˆ›å»º HOC

ä¸è¦åœ¨ç»„ä»¶çš„ render æ–¹æ³•ä¸­ä½¿ç”¨ HOCï¼Œè¿™ä¼šå¯¼è‡´æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°ç»„ä»¶ã€‚

```jsx
// âŒ é”™è¯¯ï¼šæ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°ç»„ä»¶
class MyComponent extends React.Component {
  render() {
    // æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šåˆ›å»ºæ–°çš„ EnhancedComponent
    const EnhancedComponent = withLogger(InnerComponent);
    return <EnhancedComponent />;
  }
}

// âœ… æ­£ç¡®ï¼šåœ¨ç»„ä»¶å¤–éƒ¨åˆ›å»º
const EnhancedComponent = withLogger(InnerComponent);

class MyComponent extends React.Component {
  render() {
    return <EnhancedComponent />;
  }
}
```

### 5. è°ƒè¯•å›°éš¾

HOC ä¼šè®©ç»„ä»¶æ ‘å˜å¾—å¤æ‚ï¼Œè°ƒè¯•æ—¶éš¾ä»¥è¯†åˆ«ã€‚

```jsx
// âœ… è§£å†³ï¼šè®¾ç½® displayName
function withLogger(WrappedComponent) {
  function Enhanced(props) {
    return <WrappedComponent {...props} />;
  }
  
  // è®¾ç½®æœ‰æ„ä¹‰çš„ displayName
  const wrappedName = WrappedComponent.displayName 
    || WrappedComponent.name 
    || 'Component';
  
  Enhanced.displayName = `withLogger(${wrappedName})`;
  
  return Enhanced;
}

// React DevTools ä¸­ä¼šæ˜¾ç¤ºä¸ºï¼šwithLogger(MyComponent)
```

---

## å¸¸è§é—®é¢˜

### 1. HOC vs Hooks

| ç‰¹æ€§ | HOC | Hooks |
|------|-----|-------|
| **å¤ç”¨æ–¹å¼** | ç»„ä»¶åŒ…è£… | å‡½æ•°è°ƒç”¨ |
| **åµŒå¥—é—®é¢˜** | å®¹æ˜“äº§ç”ŸåµŒå¥—åœ°ç‹± | æ‰å¹³åŒ–ï¼Œæ— åµŒå¥— |
| **props æ¥æº** | ä¸æ¸…æ™°ï¼ˆå¯èƒ½æ¥è‡ªå¤šä¸ª HOCï¼‰ | æ¸…æ™°ï¼ˆç›´æ¥çœ‹åˆ°è°ƒç”¨ï¼‰ |
| **æ€§èƒ½** | æ¯ä¸ª HOC å¢åŠ ä¸€å±‚ç»„ä»¶ | æ— é¢å¤–ç»„ä»¶ |
| **ç±»å‹æ¨å¯¼** | TypeScript ç±»å‹æ¨å¯¼å›°éš¾ | ç±»å‹æ¨å¯¼å‹å¥½ |
| **å­¦ä¹ æ›²çº¿** | éœ€è¦ç†è§£é«˜é˜¶å‡½æ•° | æ›´ç›´è§‚ |
| **é€‚ç”¨åœºæ™¯** | ç±»ç»„ä»¶æ—¶ä»£çš„ä¸»æµæ–¹æ¡ˆ | å‡½æ•°ç»„ä»¶çš„é¦–é€‰æ–¹æ¡ˆ |

```jsx
// HOC æ–¹å¼
const EnhancedComponent = withAuth(withLoading(withData(MyComponent)));

// Hooks æ–¹å¼ï¼ˆæ›´æ¨èï¼‰
function MyComponent() {
  const auth = useAuth();
  const loading = useLoading();
  const data = useData();
  
  if (!auth) return <div>è¯·ç™»å½•</div>;
  if (loading) return <div>åŠ è½½ä¸­...</div>;
  
  return <div>{data}</div>;
}
```

### 2. HOC çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ

HOC æ˜¯ä¸€ä¸ª**çº¯å‡½æ•°**ï¼Œä½“ç°äº†ä»¥ä¸‹è®¾è®¡æ¨¡å¼ï¼š

- **è£…é¥°å™¨æ¨¡å¼**ï¼šåœ¨ä¸ä¿®æ”¹åŸå¯¹è±¡çš„åŸºç¡€ä¸Šå¢å¼ºåŠŸèƒ½
- **é«˜é˜¶å‡½æ•°**ï¼šå‡½æ•°æ¥æ”¶å‡½æ•°ï¼Œè¿”å›å‡½æ•°
- **ç»„åˆä¼˜äºç»§æ‰¿**ï¼šé€šè¿‡ç»„åˆè€Œéç»§æ‰¿å¤ç”¨é€»è¾‘

```javascript
// HOC çš„æœ¬è´¨
const hoc = (Component) => (props) => {
  // å¢å¼ºé€»è¾‘
  return <Component {...props} />;
};
```

### 3. HOC çš„çº¦å®šå’Œæœ€ä½³å®è·µ

**çº¦å®šï¼š**

1. **é€ä¼ æ— å…³ props**ï¼šå°†ä¸ HOC æ— å…³çš„ props ä¼ é€’ç»™è¢«åŒ…è£…ç»„ä»¶
2. **æœ€å¤§åŒ–å¯ç»„åˆæ€§**ï¼šHOC åº”è¯¥æ˜¯å¯ç»„åˆçš„
3. **åŒ…è£…æ˜¾ç¤ºåç§°**ï¼šè®¾ç½® displayName ä¾¿äºè°ƒè¯•
4. **ä¸è¦æ”¹å˜åŸç»„ä»¶**ï¼šä½¿ç”¨ç»„åˆè€Œéä¿®æ”¹
5. **ä¸è¦åœ¨ render ä¸­ä½¿ç”¨**ï¼šä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜

```jsx
function withSubscription(WrappedComponent, selectData) {
  function WithSubscription(props) {
    const [data, setData] = useState(null);
    
    useEffect(() => {
      const subscription = selectData(props);
      setData(subscription);
      return () => subscription.unsubscribe();
    }, [props]);
    
    // 1. é€ä¼  props
    return <WrappedComponent data={data} {...props} />;
  }
  
  // 3. è®¾ç½® displayName
  WithSubscription.displayName = `WithSubscription(${
    WrappedComponent.displayName || WrappedComponent.name || 'Component'
  })`;
  
  return WithSubscription;
}
```

### 4. å¦‚ä½•å®ç°æ¡ä»¶æ¸²æŸ“çš„ HOCï¼Ÿ

```jsx
function withConditionalRender(WrappedComponent, condition) {
  return function ConditionalComponent(props) {
    if (!condition(props)) {
      return null; // æˆ–è¿”å› fallback ç»„ä»¶
    }
    
    return <WrappedComponent {...props} />;
  };
}

// ä½¿ç”¨
const isAdmin = (props) => props.user?.role === 'admin';
const AdminOnlyComponent = withConditionalRender(Dashboard, isAdmin);
```

### 5. HOC å¦‚ä½•å¤„ç†å¼‚æ­¥é€»è¾‘ï¼Ÿ

```jsx
function withAsyncData(WrappedComponent, fetchData) {
  return function AsyncComponent(props) {
    const [state, setState] = useState({
      data: null,
      loading: true,
      error: null
    });

    useEffect(() => {
      let cancelled = false;

      const loadData = async () => {
        try {
          setState({ data: null, loading: true, error: null });
          const result = await fetchData(props);
          
          if (!cancelled) {
            setState({ data: result, loading: false, error: null });
          }
        } catch (error) {
          if (!cancelled) {
            setState({ data: null, loading: false, error });
          }
        }
      };

      loadData();

      // æ¸…ç†å‡½æ•°ï¼šé˜²æ­¢ç»„ä»¶å¸è½½åæ›´æ–°çŠ¶æ€
      return () => {
        cancelled = true;
      };
    }, [props.id]);

    return (
      <WrappedComponent 
        {...props} 
        data={state.data}
        loading={state.loading}
        error={state.error}
      />
    );
  };
}
```

### 6. HOC ä¸ Render Props çš„åŒºåˆ«ï¼Ÿ

```jsx
// HOC æ–¹å¼
const EnhancedComponent = withMouse(MyComponent);

function MyComponent({ mouse }) {
  return <div>é¼ æ ‡ä½ç½®: {mouse.x}, {mouse.y}</div>;
}

// Render Props æ–¹å¼
<Mouse>
  {mouse => (
    <div>é¼ æ ‡ä½ç½®: {mouse.x}, {mouse.y}</div>
  )}
</Mouse>

// å¯¹æ¯”
// HOC: é™æ€ç»„åˆï¼Œç¼–è¯‘æ—¶ç¡®å®š
// Render Props: åŠ¨æ€ç»„åˆï¼Œè¿è¡Œæ—¶ç¡®å®š
// HOC: å¯èƒ½æœ‰ props å‘½åå†²çª
// Render Props: æ˜ç¡®çš„æ•°æ®æµ
```

### 7. å®é™…é¡¹ç›®ä¸­ HOC çš„åº”ç”¨åœºæ™¯

1. **æƒé™æ§åˆ¶**ï¼š`withAuth`ã€`withRole`
2. **æ•°æ®è·å–**ï¼š`withData`ã€`withQuery`
3. **æ€§èƒ½ä¼˜åŒ–**ï¼š`withMemo`ã€`withLazy`
4. **é”™è¯¯è¾¹ç•Œ**ï¼š`withErrorBoundary`
5. **å›½é™…åŒ–**ï¼š`withTranslation`
6. **ä¸»é¢˜åˆ‡æ¢**ï¼š`withTheme`
7. **åŸ‹ç‚¹ç»Ÿè®¡**ï¼š`withAnalytics`

```jsx
// å®é™…åº”ç”¨ï¼šç»„åˆå¤šä¸ª HOC
const enhance = compose(
  withAuth,
  withErrorBoundary,
  withAnalytics,
  withTheme
);

export default enhance(MyComponent);
```

---

## æ ¸å¿ƒè¦ç‚¹æ€»ç»“

1. **å®šä¹‰**ï¼šHOC æ˜¯æ¥æ”¶ç»„ä»¶è¿”å›æ–°ç»„ä»¶çš„çº¯å‡½æ•°
2. **ç›®çš„**ï¼šå¤ç”¨ç»„ä»¶é€»è¾‘ï¼Œå®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹
3. **åŸåˆ™**ï¼šä¸ä¿®æ”¹åŸç»„ä»¶ï¼Œé€ä¼  propsï¼Œå¯ç»„åˆ
4. **é—®é¢˜**ï¼šref è½¬å‘ã€é™æ€æ–¹æ³•ä¸¢å¤±ã€props å†²çªã€è°ƒè¯•å›°éš¾
5. **å¯¹æ¯”**ï¼šHooks æ˜¯æ›´ç°ä»£çš„æ›¿ä»£æ–¹æ¡ˆï¼Œä½† HOC åœ¨æŸäº›åœºæ™¯ä»æœ‰ä»·å€¼
6. **æœ€ä½³å®è·µ**ï¼šè®¾ç½® displayNameã€ä½¿ç”¨ forwardRefã€é¿å…åœ¨ render ä¸­åˆ›å»º
7. **åº”ç”¨**ï¼šæƒé™æ§åˆ¶ã€æ•°æ®è·å–ã€æ€§èƒ½ä¼˜åŒ–ç­‰æ¨ªåˆ‡å…³æ³¨ç‚¹
