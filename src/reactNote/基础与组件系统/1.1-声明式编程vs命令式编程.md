# 1.1 声明式编程 vs 命令式编程

## 1. 概念讲解

* **命令式编程 (Imperative Programming)**: 关注**如何做 (How)**。你需要一步步告诉计算机如何执行，比如如何操作 DOM，如何遍历数组等。
* **声明式编程 (Declarative Programming)**: 关注**做什么 (What)**。你只需要告诉计算机你想要什么结果，底层的实现细节由框架或语言处理。

React 是典型的声明式 UI 框架。你只需要描述 UI 的状态，React 会负责将 UI 更新到与状态匹配。

## 2. 实现思路：DOM 操作 vs JSX

### 场景：点击按钮，数字加 1

#### 命令式 (jQuery / 原生 JS)

你需要手动查找 DOM 元素，绑定事件，读取当前值，计算新值，然后更新 DOM 的文本内容。

#### 声明式 (React)

你只需要定义一个状态 `count`，并在 JSX 中使用它。当 `count` 变化时，React 自动更新 DOM。

## 3. 模拟实现：简易声明式框架

为了理解 React 如何实现声明式编程，我们模拟一个最简单的 `render` 函数，它接受“描述”（虚拟 DOM）并将其转换为真实 DOM。

```javascript
// 1. 定义数据结构 (虚拟 DOM)
// 这种对象描述了我们想要什么样的 UI
const vdom = {
  type: 'div',
  props: {
    id: 'app',
    children: [
      {
        type: 'h1',
        props: { children: 'Count: 0' }
      },
      {
        type: 'button',
        props: { 
          onClick: () => console.log('Clicked'),
          children: 'Add' 
        }
      }
    ]
  }
};

// 2. 命令式的渲染函数 (React 的脏活累活)
// 框架内部使用命令式代码来处理具体的 DOM 操作
function render(vNode, container) {
  // 处理文本节点
  if (typeof vNode === 'string' || typeof vNode === 'number') {
    container.appendChild(document.createTextNode(vNode));
    return;
  }

  // 创建真实 DOM 元素
  const dom = document.createElement(vNode.type);

  // 处理属性
  if (vNode.props) {
    Object.keys(vNode.props).forEach(key => {
      const value = vNode.props[key];
      
      if (key === 'children') {
        // 递归处理子节点
        if (Array.isArray(value)) {
          value.forEach(child => render(child, dom));
        } else {
          render(value, dom);
        }
      } else if (key.startsWith('on')) {
        // 处理事件绑定
        const eventName = key.slice(2).toLowerCase();
        dom.addEventListener(eventName, value);
      } else {
        // 处理普通属性
        dom.setAttribute(key, value);
      }
    });
  }

  // 挂载到容器
  container.appendChild(dom);
}

// 3. 开发者只需要调用一次
// render(vdom, document.getElementById('root'));
```

## 4. 常见问题

### Q1: 声明式编程的优势是什么？

**答**：

1. **可读性更高**：代码描述的是结果，更容易理解业务逻辑。
2. **可维护性更强**：减少了手动操作 DOM 带来的副作用和 Bug（如状态不同步）。
3. **开发效率高**：开发者只需关注状态管理，无需关心繁琐的 DOM 更新细节。

### Q2: React 如何实现声明式编程？

**答**：
React 通过 **虚拟 DOM (Virtual DOM)** 和 **协调算法 (Reconciliation)** 实现了声明式编程。
开发者编写 JSX（声明 UI 结构），React 将其转换为虚拟 DOM。当状态变化时，React 生成新的虚拟 DOM，通过 Diff 算法对比新旧虚拟 DOM 的差异，然后仅将差异部分应用到真实 DOM 上。这个过程对开发者是透明的。

### Q3: 声明式编程性能一定比命令式差吗？

**答**：
不一定，但通常会有一些性能损耗。

* **命令式**：可以直接进行极致优化的 DOM 操作（手动挡赛车）。
* **声明式**：引入了虚拟 DOM Diff 等运行时开销（自动挡轿车）。
但在复杂的应用中，由于手动优化 DOM 操作非常困难且容易出错，React 的批量更新和 Diff 算法往往能提供**足够好且稳定**的性能表现，甚至优于写得不好的命令式代码。
