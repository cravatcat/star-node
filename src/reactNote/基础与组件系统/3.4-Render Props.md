# 3.4 Render Props ğŸ’¡

## æ¦‚å¿µè®²è§£

**Render Props** æ˜¯ä¸€ç§åœ¨ React ç»„ä»¶é—´å…±äº«ä»£ç çš„æŠ€æœ¯ï¼Œé€šè¿‡ä¼ é€’ä¸€ä¸ªå‡½æ•°ä½œä¸º prop æ¥å‘Šè¯‰ç»„ä»¶è¦æ¸²æŸ“ä»€ä¹ˆå†…å®¹ã€‚è¿™ä¸ªå‡½æ•°æ¥æ”¶ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€æˆ–æ•°æ®ä½œä¸ºå‚æ•°ï¼Œè¿”å›è¦æ¸²æŸ“çš„ React å…ƒç´ ã€‚

### æ ¸å¿ƒæ€æƒ³

- **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šé€»è¾‘ç»„ä»¶è´Ÿè´£çŠ¶æ€ç®¡ç†ï¼ŒUI ç»„ä»¶è´Ÿè´£æ¸²æŸ“
- **é«˜åº¦çµæ´»**ï¼šä½¿ç”¨è€…å®Œå…¨æ§åˆ¶æ¸²æŸ“å†…å®¹
- **ä»£ç å¤ç”¨**ï¼šç›¸åŒé€»è¾‘å¯ä»¥ç”¨äºä¸åŒçš„ UI è¡¨ç°

## å®ç°æ€è·¯

### åŸºæœ¬æ¨¡å¼

```javascript
// é€»è¾‘ç»„ä»¶
class DataProvider extends React.Component {
  state = { data: null, loading: true }
  
  componentDidMount() {
    this.fetchData()
  }
  
  fetchData = async () => {
    const data = await api.getData()
    this.setState({ data, loading: false })
  }
  
  render() {
    // è°ƒç”¨ render propï¼Œä¼ é€’çŠ¶æ€
    return this.props.render(this.state)
  }
}

// ä½¿ç”¨æ–¹å¼
<DataProvider 
  render={({ data, loading }) => (
    loading ? <Loading /> : <DataList data={data} />
  )}
/>
```

### å¸¸è§å˜ä½“

```javascript
// 1. children ä½œä¸ºå‡½æ•°
<DataProvider>
  {({ data, loading }) => (
    loading ? <Loading /> : <DataList data={data} />
  )}
</DataProvider>

// 2. å‘½å prop
<DataProvider 
  component={({ data, loading }) => (
    loading ? <Loading /> : <DataList data={data} />
  )}
/>
```

## æ¨¡æ‹Ÿå®ç°

### 1. é¼ æ ‡ä½ç½®è¿½è¸ªå™¨

```javascript
class MouseTracker extends React.Component {
  state = { x: 0, y: 0 }
  
  handleMouseMove = (event) => {
    this.setState({
      x: event.clientX,
      y: event.clientY
    })
  }
  
  componentDidMount() {
    document.addEventListener('mousemove', this.handleMouseMove)
  }
  
  componentWillUnmount() {
    document.removeEventListener('mousemove', this.handleMouseMove)
  }
  
  render() {
    return (
      <div style={{ height: '100vh' }}>
        {this.props.render(this.state)}
      </div>
    )
  }
}

// ä½¿ç”¨ç¤ºä¾‹
function App() {
  return (
    <MouseTracker 
      render={({ x, y }) => (
        <h1>é¼ æ ‡ä½ç½®: ({x}, {y})</h1>
      )}
    />
  )
}
```

### 2. æ•°æ®è·å–ç»„ä»¶

```javascript
class DataFetcher extends React.Component {
  state = {
    data: null,
    loading: true,
    error: null
  }
  
  async componentDidMount() {
    try {
      const response = await fetch(this.props.url)
      const data = await response.json()
      this.setState({ data, loading: false })
    } catch (error) {
      this.setState({ error, loading: false })
    }
  }
  
  render() {
    return this.props.children(this.state)
  }
}

// ä½¿ç”¨ç¤ºä¾‹
function UserProfile({ userId }) {
  return (
    <DataFetcher url={`/api/users/${userId}`}>
      {({ data, loading, error }) => {
        if (loading) return <div>åŠ è½½ä¸­...</div>
        if (error) return <div>é”™è¯¯: {error.message}</div>
        return <div>ç”¨æˆ·: {data.name}</div>
      }}
    </DataFetcher>
  )
}
```

### 3. è¡¨å•çŠ¶æ€ç®¡ç†

```javascript
class FormProvider extends React.Component {
  state = {
    values: {},
    errors: {},
    touched: {}
  }
  
  setValue = (name, value) => {
    this.setState(prevState => ({
      values: { ...prevState.values, [name]: value },
      touched: { ...prevState.touched, [name]: true }
    }))
  }
  
  setError = (name, error) => {
    this.setState(prevState => ({
      errors: { ...prevState.errors, [name]: error }
    }))
  }
  
  validate = () => {
    const { values } = this.state
    const errors = {}
    
    // éªŒè¯é€»è¾‘
    if (!values.email) {
      errors.email = 'é‚®ç®±ä¸èƒ½ä¸ºç©º'
    } else if (!/\S+@\S+\.\S+/.test(values.email)) {
      errors.email = 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®'
    }
    
    this.setState({ errors })
    return Object.keys(errors).length === 0
  }
  
  handleSubmit = (onSubmit) => (e) => {
    e.preventDefault()
    if (this.validate()) {
      onSubmit(this.state.values)
    }
  }
  
  render() {
    return this.props.children({
      ...this.state,
      setValue: this.setValue,
      setError: this.setError,
      handleSubmit: this.handleSubmit
    })
  }
}

// ä½¿ç”¨ç¤ºä¾‹
function LoginForm() {
  return (
    <FormProvider>
      {({ values, errors, setValue, handleSubmit }) => (
        <form onSubmit={handleSubmit(console.log)}>
          <input
            type="email"
            value={values.email || ''}
            onChange={(e) => setValue('email', e.target.value)}
            placeholder="é‚®ç®±"
          />
          {errors.email && <span>{errors.email}</span>}
          
          <button type="submit">ç™»å½•</button>
        </form>
      )}
    </FormProvider>
  )
}
```

### 4. åˆ‡æ¢çŠ¶æ€ç»„ä»¶

```javascript
class Toggle extends React.Component {
  state = { on: this.props.defaultOn || false }
  
  toggle = () => {
    this.setState(prevState => ({ on: !prevState.on }))
  }
  
  render() {
    return this.props.children({
      on: this.state.on,
      toggle: this.toggle
    })
  }
}

// ä½¿ç”¨ç¤ºä¾‹
function App() {
  return (
    <Toggle defaultOn={false}>
      {({ on, toggle }) => (
        <div>
          <button onClick={toggle}>
            {on ? 'å…³é—­' : 'å¼€å¯'}
          </button>
          {on && <div>å†…å®¹å·²æ˜¾ç¤º</div>}
        </div>
      )}
    </Toggle>
  )
}
```

## é«˜çº§æ¨¡å¼

### 1. å¤åˆç»„ä»¶æ¨¡å¼

```javascript
class Accordion extends React.Component {
  state = { activeIndex: 0 }
  
  setActiveIndex = (index) => {
    this.setState({ activeIndex: index })
  }
  
  render() {
    return this.props.children({
      activeIndex: this.state.activeIndex,
      setActiveIndex: this.setActiveIndex
    })
  }
}

function AccordionItem({ index, title, children, isActive, onClick }) {
  return (
    <div>
      <button onClick={() => onClick(index)}>
        {title} {isActive ? 'â–¼' : 'â–¶'}
      </button>
      {isActive && <div>{children}</div>}
    </div>
  )
}

// ä½¿ç”¨ç¤ºä¾‹
function App() {
  return (
    <Accordion>
      {({ activeIndex, setActiveIndex }) => (
        <div>
          <AccordionItem
            index={0}
            title="ç¬¬ä¸€é¡¹"
            isActive={activeIndex === 0}
            onClick={setActiveIndex}
          >
            ç¬¬ä¸€é¡¹å†…å®¹
          </AccordionItem>
          <AccordionItem
            index={1}
            title="ç¬¬äºŒé¡¹"
            isActive={activeIndex === 1}
            onClick={setActiveIndex}
          >
            ç¬¬äºŒé¡¹å†…å®¹
          </AccordionItem>
        </div>
      )}
    </Accordion>
  )
}
```

### 2. çŠ¶æ€ç¼“å­˜ç»„ä»¶

```javascript
class StateCache extends React.Component {
  state = { cache: new Map() }
  
  getState = (key, initialState) => {
    const { cache } = this.state
    if (!cache.has(key)) {
      cache.set(key, initialState)
      this.setState({ cache: new Map(cache) })
    }
    return cache.get(key)
  }
  
  setState = (key, updater) => {
    const { cache } = this.state
    const currentState = cache.get(key)
    const newState = typeof updater === 'function' 
      ? updater(currentState) 
      : updater
    
    cache.set(key, newState)
    this.setState({ cache: new Map(cache) })
  }
  
  render() {
    return this.props.children({
      getState: this.getState,
      setState: this.setState
    })
  }
}
```

## æ€§èƒ½ä¼˜åŒ–

### 1. é¿å…å†…è”å‡½æ•°

```javascript
// âŒ æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å‡½æ•°
<DataProvider 
  render={({ data }) => <UserList data={data} />}
/>

// âœ… ä½¿ç”¨ç»„ä»¶æ–¹æ³•æˆ–å¤–éƒ¨å‡½æ•°
class App extends React.Component {
  renderUserList = ({ data }) => <UserList data={data} />
  
  render() {
    return <DataProvider render={this.renderUserList} />
  }
}
```

### 2. ä½¿ç”¨ React.memo

```javascript
const UserList = React.memo(({ data }) => (
  <div>
    {data.map(user => <div key={user.id}>{user.name}</div>)}
  </div>
))
```

## å¸¸è§é—®é¢˜

### vs HOC å¯¹æ¯”

| ç‰¹æ€§ | Render Props | HOC |
|------|-------------|-----|
| **çµæ´»æ€§** | é«˜ï¼Œå®Œå…¨æ§åˆ¶æ¸²æŸ“ | ä¸­ï¼Œé¢„å®šä¹‰å¢å¼º |
| **å¯è¯»æ€§** | ä¸­ï¼ŒåµŒå¥—å¯èƒ½å¤æ‚ | é«˜ï¼Œè£…é¥°å™¨æ¨¡å¼ |
| **é™æ€åˆ†æ** | éš¾ï¼ŒåŠ¨æ€æ¸²æŸ“ | æ˜“ï¼Œé™æ€åŒ…è£… |
| **props å†²çª** | æ— ï¼Œæ˜¾å¼ä¼ é€’ | æœ‰ï¼Œå¯èƒ½è¦†ç›– |
| **ç»„åˆ** | åµŒå¥—è°ƒç”¨ | compose å‡½æ•° |

### ä¼˜ç¼ºç‚¹

**ä¼˜ç‚¹ï¼š**

- é«˜åº¦çµæ´»ï¼Œä½¿ç”¨è€…å®Œå…¨æ§åˆ¶æ¸²æŸ“
- é¿å… props å‘½åå†²çª
- è¿è¡Œæ—¶å†³å®šæ¸²æŸ“å†…å®¹
- æ˜“äºç†è§£å’Œè°ƒè¯•

**ç¼ºç‚¹ï¼š**

- å¯èƒ½å¯¼è‡´åµŒå¥—åœ°ç‹±
- æ€§èƒ½å¼€é”€ï¼ˆæ¯æ¬¡æ¸²æŸ“åˆ›å»ºå‡½æ•°ï¼‰
- é™æ€åˆ†æå›°éš¾
- TypeScript ç±»å‹æ¨å¯¼å¤æ‚

### ä½¿ç”¨åœºæ™¯

1. **çŠ¶æ€é€»è¾‘å¤ç”¨**ï¼šé¼ æ ‡ä½ç½®ã€çª—å£å°ºå¯¸ã€æ»šåŠ¨ä½ç½®
2. **æ•°æ®è·å–**ï¼šAPI è°ƒç”¨ã€ç¼“å­˜ç®¡ç†
3. **è¡¨å•å¤„ç†**ï¼šéªŒè¯ã€çŠ¶æ€ç®¡ç†
4. **UI çŠ¶æ€**ï¼šæ¨¡æ€æ¡†ã€ä¸‹æ‹‰èœå•ã€æ‰‹é£ç´

### ç°ä»£æ›¿ä»£æ–¹æ¡ˆ

```javascript
// Render Props
<MouseTracker 
  render={({ x, y }) => <div>({x}, {y})</div>}
/>

// Custom Hook (æ¨è)
function useMouse() {
  const [position, setPosition] = useState({ x: 0, y: 0 })
  
  useEffect(() => {
    const handleMove = (e) => {
      setPosition({ x: e.clientX, y: e.clientY })
    }
    
    document.addEventListener('mousemove', handleMove)
    return () => document.removeEventListener('mousemove', handleMove)
  }, [])
  
  return position
}

function App() {
  const { x, y } = useMouse()
  return <div>({x}, {y})</div>
}
```

## æ€»ç»“

Render Props æ˜¯ä¸€ç§å¼ºå¤§çš„ç»„ä»¶å¤ç”¨æ¨¡å¼ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦é«˜åº¦å®šåˆ¶åŒ–æ¸²æŸ“çš„åœºæ™¯ã€‚è™½ç„¶ Hooks åœ¨å¾ˆå¤šæƒ…å†µä¸‹æä¾›äº†æ›´ç®€æ´çš„è§£å†³æ–¹æ¡ˆï¼Œä½† Render Props åœ¨æŸäº›å¤æ‚åœºæ™¯ä¸‹ä»ç„¶æœ‰å…¶ç‹¬ç‰¹ä»·å€¼ã€‚ç†è§£è¿™ç§æ¨¡å¼æœ‰åŠ©äºæ›´å¥½åœ°è®¾è®¡å¯å¤ç”¨çš„ React ç»„ä»¶ã€‚
