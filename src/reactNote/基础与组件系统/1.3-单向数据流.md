# 1.3 å•å‘æ•°æ®æµ

## 1. æ¦‚å¿µè®²è§£

**å•å‘æ•°æ®æµ (One-Way Data Flow)** æ˜¯ React çš„æ ¸å¿ƒè®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚

* **è‡ªä¸Šè€Œä¸‹**ï¼šæ•°æ®åªèƒ½ä»çˆ¶ç»„ä»¶æµå‘å­ç»„ä»¶ï¼ˆé€šè¿‡ `props`ï¼‰ã€‚
* **è‡ªä¸‹è€Œä¸Š**ï¼šå­ç»„ä»¶å¦‚æœè¦ä¿®æ”¹æ•°æ®ï¼Œå¿…é¡»é€šè¿‡çˆ¶ç»„ä»¶ä¼ é€’çš„â€œå›è°ƒå‡½æ•°â€æ¥è¯·æ±‚çˆ¶ç»„ä»¶ä¿®æ”¹çŠ¶æ€ã€‚
* **å•ä¸€æ•°æ®æº**ï¼šçŠ¶æ€åº”è¯¥ä¿å­˜åœ¨ç»„ä»¶æ ‘ä¸­â€œæ‹¥æœ‰â€è¯¥çŠ¶æ€çš„æœ€é«˜å±‚çº§ç»„ä»¶ä¸­ã€‚

## 2. å®ç°æ€è·¯

1. **State**: çˆ¶ç»„ä»¶ç»´æŠ¤çŠ¶æ€ã€‚
2. **Props**: çˆ¶ç»„ä»¶å°†çŠ¶æ€ä½œä¸º props ä¼ é€’ç»™å­ç»„ä»¶ã€‚
3. **Callback**: çˆ¶ç»„ä»¶å°†â€œä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•â€ä½œä¸º props ä¼ é€’ç»™å­ç»„ä»¶ã€‚
4. **Trigger**: å­ç»„ä»¶è§¦å‘äº‹ä»¶ï¼Œè°ƒç”¨çˆ¶ç»„ä»¶çš„æ–¹æ³•ã€‚
5. **Update**: çˆ¶ç»„ä»¶æ–¹æ³•æ‰§è¡Œï¼Œè°ƒç”¨ `setState` æ›´æ–°çŠ¶æ€ï¼Œè§¦å‘é‡æ–°æ¸²æŸ“ã€‚
6. **Re-render**: æ–°çš„æ•°æ®å†æ¬¡æµå‘å­ç»„ä»¶ã€‚

## 3. æ¨¡æ‹Ÿå®ç°ï¼šçˆ¶å­ç»„ä»¶é€šä¿¡ç³»ç»Ÿ

```javascript
// 1. æ¨¡æ‹ŸåŸºç¡€ç»„ä»¶ç±» (ç®€æ˜“ç‰ˆ)
class Component {
  constructor(props) {
    this.props = props;
    this.state = {};
  }

  setState(partialState) {
    this.state = { ...this.state, ...partialState };
    console.log(`âš¡ï¸ [${this.constructor.name}] State updated:`, this.state);
    // åœ¨çœŸå® React ä¸­ï¼Œè¿™é‡Œä¼šè§¦å‘ç»„ä»¶æ›´æ–°
  }
}

// 2. å­ç»„ä»¶ï¼šè¾“å…¥æ¡†
class InputChild extends Component {
  // æ¨¡æ‹Ÿæ¸²æŸ“
  render() {
    console.log(`  ğŸ–¼ï¸ [InputChild] Render UI with value: "${this.props.value}"`);
  }

  // æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥äº‹ä»¶
  onUserType(newValue) {
    console.log(`  ğŸ‘‡ [InputChild] User Typed: "${newValue}"`);
    // å…³é”®ï¼šè°ƒç”¨çˆ¶ç»„ä»¶ä¼ ä¸‹æ¥çš„å›è°ƒ
    if (this.props.onChange) {
      this.props.onChange(newValue);
    }
  }
}

// 3. çˆ¶ç»„ä»¶ï¼šæ•°æ®æŒæœ‰è€…
class Parent extends Component {
  constructor() {
    super();
    this.state = { text: 'Hello' };
    
    // åˆå§‹åŒ–å­ç»„ä»¶ (æ¨¡æ‹Ÿ React çš„ç»„ä»¶æ ‘æ„å»º)
    this.child = new InputChild({
      value: this.state.text,
      onChange: (newVal) => this.handleChildChange(newVal)
    });
  }

  // å®šä¹‰ä¿®æ”¹æ•°æ®çš„æ–¹æ³•
  handleChildChange(newText) {
    console.log('  ğŸ”„ [Parent] Callback received, updating state...');
    this.setState({ text: newText });
    
    // æ‰‹åŠ¨æ›´æ–°å­ç»„ä»¶ props å¹¶é‡æ–°æ¸²æŸ“ (æ¨¡æ‹Ÿ React çš„åè°ƒæ›´æ–°)
    this.child.props = {
      value: this.state.text,
      onChange: (newVal) => this.handleChildChange(newVal)
    };
    this.child.render();
  }

  render() {
    console.log(`ğŸ–¼ï¸ [Parent] Render UI with text: "${this.state.text}"`);
    this.child.render();
  }
}

// --- è¿è¡Œæ¨¡æ‹Ÿ ---

console.log('--- Init ---');
const app = new Parent();
app.render();

console.log('\n--- Action: User Input ---');
// æ¨¡æ‹Ÿç”¨æˆ·åœ¨å­ç»„ä»¶è¾“å…¥ 'World'
app.child.onUserType('World');
```

### è¾“å‡ºç»“æœ

```text
--- Init ---
ğŸ–¼ï¸ [Parent] Render UI with text: "Hello"
  ğŸ–¼ï¸ [InputChild] Render UI with value: "Hello"

--- Action: User Input ---
  ğŸ‘‡ [InputChild] User Typed: "World"
  ğŸ”„ [Parent] Callback received, updating state...
âš¡ï¸ [Parent] State updated: { text: 'World' }
  ğŸ–¼ï¸ [InputChild] Render UI with value: "World"
```

## 4. å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆ React é€‰æ‹©å•å‘æ•°æ®æµï¼Ÿ

**ç­”**ï¼š

1. **å¯æ§æ€§**ï¼šæ•°æ®æµå‘æ¸…æ™°ï¼Œæ˜“äºè¿½è¸ªçŠ¶æ€å˜åŒ–ã€‚
2. **å¯è°ƒè¯•æ€§**ï¼šå½“æ˜¾ç¤ºé”™è¯¯æ—¶ï¼Œåªéœ€å‘ä¸ŠæŸ¥æ‰¾å“ªä¸ªçˆ¶ç»„ä»¶ä¼ é€’äº†é”™è¯¯çš„ propsã€‚
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šReact å¯ä»¥æ›´ç®€å•åœ°ç¡®å®šä½•æ—¶éœ€è¦æ›´æ–°ï¼ˆå¼•ç”¨å˜åŒ–ï¼‰ã€‚

### Q2: å•å‘æ•°æ®æµ vs åŒå‘ç»‘å®š (Vue/Angular)ï¼Ÿ

**ç­”**ï¼š

* **åŒå‘ç»‘å®š**ï¼šè§†å›¾ (View) å’Œæ¨¡å‹ (Model) è‡ªåŠ¨åŒæ­¥ã€‚å¼€å‘æ•ˆç‡é«˜ï¼Œä½†åœ¨å¤æ‚åº”ç”¨ä¸­ï¼ŒçŠ¶æ€å˜åŒ–å¯èƒ½å˜å¾—éš¾ä»¥é¢„æµ‹ï¼ˆSide Effectsï¼‰ã€‚
* **å•å‘æ•°æ®æµ**ï¼šçŠ¶æ€å˜åŒ–å¿…é¡»æ˜¾å¼è§¦å‘ã€‚è™½ç„¶ä»£ç é‡å¯èƒ½ç¨å¤šï¼Œä½†é€»è¾‘æ›´ä¸¥è°¨ï¼Œé€‚åˆå¤§å‹åº”ç”¨ç»´æŠ¤ã€‚
*(æ³¨ï¼šVue ä¹Ÿæ˜¯å•å‘æ•°æ®æµï¼ŒåŒå‘ç»‘å®š `v-model` åªæ˜¯è¯­æ³•ç³–)*

### Q3: å…„å¼Ÿç»„ä»¶å¦‚ä½•é€šä¿¡ï¼Ÿ

**ç­”**ï¼š

**çŠ¶æ€æå‡ (Lifting State Up)**ã€‚å°†å…±äº«çŠ¶æ€æå‡åˆ°å®ƒä»¬æœ€è¿‘çš„å…±åŒçˆ¶ç»„ä»¶ä¸­ï¼Œçˆ¶ç»„ä»¶é€šè¿‡ props å°†çŠ¶æ€ä¼ é€’ç»™ä¸€ä¸ªå­ç»„ä»¶ï¼Œå°†å›è°ƒä¼ é€’ç»™å¦ä¸€ä¸ªå­ç»„ä»¶ã€‚
