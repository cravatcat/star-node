# 70. 柱状图中最大的矩形

## 题目描述

给定 `n` 个非负整数，用来表示柱状图中各个柱子的高度。每个柱子彼此相邻，且宽度为 `1` 。

求在该柱状图中，能够勾勒出来的矩形的最大面积。

**示例 1:**

```text
输入：heights = [2,1,5,6,2,3]
输出：10
解释：最大的矩形为 5 和 6 组成的区域，面积 = 5 * 2 = 10。
```

**示例 2:**

```text
输入： heights = [2,4]
输出： 4
```

## 实现思路

这道题的核心是找到以每根柱子为高度的最大矩形面积。
对于每根柱子 `i`，我们需要找到它左边第一个比它矮的柱子 `left_i` 和右边第一个比它矮的柱子 `right_i`。
那么以柱子 `i` 为高度的矩形面积就是 `heights[i] * (right_i - left_i - 1)`。

我们可以使用 **单调递增栈** 来高效地找到左右两边第一个比它矮的柱子。

具体步骤：
1. 为了简化边界处理，我们在数组的首尾各添加一个高度为 `0` 的哨兵。
   - 首部的 `0` 可以防止栈为空。
   - 尾部的 `0` 可以保证最后栈内的所有元素都能被弹出计算。
2. 维护一个单调递增栈，存储数组的索引。
3. 遍历数组：
   - 如果当前高度 `newHeights[i]` 小于栈顶索引对应的高度 `newHeights[stack.top()]`，说明我们找到了栈顶元素的“右边界”（即 `i`）。
   - 此时，栈顶元素出栈，记为 `curHeight`。
   - 新的栈顶元素就是 `curHeight` 的“左边界”。
   - 计算面积：`curHeight * (i - stack.top() - 1)`，并更新最大面积。
   - 重复此过程，直到当前高度大于等于栈顶高度。
   - 将当前索引 `i` 入栈。

## 代码实现

```typescript
export function largestRectangleArea(heights: number[]): number {
  // 在数组首尾各添加一个 0，方便处理边界情况
  // 首位 0 保证栈内元素不为空（至少有 0）
  // 末位 0 保证最后能把栈内所有元素弹出计算
  const newHeights = [0, ...heights, 0];
  const stack: number[] = [0]; // 存储索引，初始放入哨兵
  let maxArea = 0;

  for (let i = 1; i < newHeights.length; i++) {
    // 如果当前高度小于栈顶高度，说明找到了右边界
    while (stack.length > 0 && newHeights[i] < newHeights[stack[stack.length - 1]]) {
      const curHeight = newHeights[stack.pop()!];
      const curWidth = i - stack[stack.length - 1] - 1;
      maxArea = Math.max(maxArea, curHeight * curWidth);
    }
    stack.push(i);
  }

  return maxArea;
}
```

## 复杂度分析

- **时间复杂度**：O(n)，其中 n 是数组的长度。每个元素最多入栈一次，出栈一次。
- **空间复杂度**：O(n)，栈的大小最大为 O(n)。
